<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>系统管理</title>
    <script>
        window.onload = function () {
            removeOverlay();
        };
        window.setTimeout( function () {
            removeOverlay();
        }, 8000 );
        function removeOverlay() {
            document.getElementById( "bodyLoadingOverlay" ).style.display = "none";
            document.body.setAttribute( "class", "" );
        }
    </script>
    <title></title>
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lte IE 8]>
    <script src="../../../dev/modules/lib/ie/respond.js"></script>
    <script src="../../../dev/modules/lib/ie/html5shiv.js"></script>
    <script src="../../../dev/modules/lib/ie/es5-shim.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="../../../dev/modules/ui/css/pku.css?VERSION=v0.20161013"/>
    <link rel="stylesheet" href="css/style.css?VERSION=v0.20161013"/>
    <script data-main="../../../dev/modules/" src="../../../dev/modules/require.js"></script>
    <script>
        var VERSION,
                DEV_MODE
                ;
        DEV_MODE = false;
        VERSION = DEV_MODE ? (new Date()).getTime() : "v0.20161013";
        require.config( {
            urlArgs: "VERSION=" + VERSION,
            paths: {
                "jquery": "jquery/jquery-1.11.3",
                "xDomainRequest": "jquery/jQuery.XDomainRequest",
                "ajaxQueue": "jquery/jQuery.ajaxQueue",
                "doT": "utils/doT",
                "draggable": "utils/draggable",
                "bootstrap": "lib/bootstrap/js/bootstrap",

                "datepicker": "lib/datepicker/js/bootstrap-datepicker-zh.fix",

                "select2": "lib/select2/js/select2.full.fix",

                "echarts": "lib/echart/echarts.min",
                "echartsTheme": "lib/echart/theme/macarons",
                "echartsChinaMap": "lib/echart/map/china",

                "formvalidation": "lib/formvalidate/js/formValidation.fix",
                "formvalidationBs": "lib/formvalidate/js/framework/bootstrap.fix",
                "formvalidationI18N": "lib/formvalidate/js/language/zh_CN",

                "webuploader": "lib/webuploader/js/webuploader.fix",

                "bootgrid": "lib/bootgrid/js/jquery.bootgrid.fix",
                "colresizable": "lib/colresizable/colResizable-1.6",

                "select-area": "lib/select-area/select-area",
                "select-area-data": "lib/select-area/select-area-data",
                "sweet-alert": "lib/sweetalert/js/sweet-alert",

                "fixrecord": "lib/custom/fixrecord",

                // 代码美化
                "code-pretty": "lib/pretty/prettify.min"
            },
            map: {
                '*': {
                    'css': 'utils/css/css',
                    'text': 'utils/text'
                }
            },
            shim: {
                "datepicker": [ "jquery" ],
                "select2": [ "jquery", "xDomainRequest" ],
                "bootstrap": [ "jquery" ],
                "formvalidation": [ "jquery", "bootstrap" ],
                "formvalidationBs": [ "formvalidation" ],
                "formvalidationI18N": [ "formvalidation", "formvalidationBs" ],
                "webuploader": [ "css!lib/webuploader/css/webuploader.css" ],
                "colresizable": [ "jquery" ],
                "bootgrid": [ "css!lib/bootgrid/css/jquery.bootgrid.css", "bootstrap", "colresizable" ],
                "select-area": [ "css!lib/select-area/css/select-area.css" ],
                "sweet-alert": [ "jquery" ],
                "code-pretty": [ "css!lib/pretty/prettify.css" ]
            },
            // 超时
            waitSeconds: 150
        } );
    </script>
    <script src="js/main.js"></script>
</head>
<body class="modal-open">

<div class="overlay" id="bodyLoadingOverlay">
    <i class="fa fa-spin fa-spinner"></i>
</div>
<!-- page -->
<div class="page page-index">

    <!--  page-header -->
    <div class="page-header">
        <a class="logo" href="index.html"><i class="fa fa-gitlab"></i><span class="logo-text">北大高科系统管理</span></a>
        <div class="nav">
            <div class="nav-item nav-list active">
                <a class="nav-item-link" href="javascript:void(0);">功能模块 <span class="caret"></span></a>
                <div class="sub-nav service-list">
                    <table>
                        <tr>
                            <td class="sub-nav-section">
                                <div class="title">系统相关</div>
                                <div class="list">
                                    <div class="item"><a href="#/bcd/manage/list"><i class="icon fa fa-gear"></i>系统管理</a></div>
                                </div>
                            </td>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                            <td class="sub-nav-section">
                                <div class="title">其他模块</div>
                                <div class="list">
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

        </div>
        <div class="header-select user-info pull-right">
            <span class="select-title">吴钦飞 <span class="caret"></span></span>
            <div class="select-list">
                <div class="select-item"><a href="#"><i class="icon fa fa-user"></i>用户信息</a></div>
                <div class="select-item"><a href="#"><i class="icon fa fa-sign-out"></i>退出</a></div>
            </div>
        </div>
    </div>
    <!--  /page-header -->

    <!-- page-content -->
    <div class="page-content">

        <div class="sidebar">
            <div class="sidebar-menu-header">系统管理</div>
            <div class="sidebar-menu-item active"><a href="#/bcd/overview"><i class="icon fa fa-home"></i>单位管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-user"></i>用户管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-user-secret"></i>角色管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-cogs"></i>系统参数</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-book"></i>字典管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-cubes"></i>资源管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-link"></i>菜单管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-file-text"></i>日志管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-puzzle-piece"></i>功能管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-times-circle-o"></i>错误号管理</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-wrench"></i>数据权限开发</a></div>
            <div class="sidebar-menu-item"><a href="#/bcd/manage/list"><i class="icon fa fa-list-ol"></i>编号管理</a></div>
            <!--
            <div class="sidebar-menu-item sidebar-menu-list sidebar-menu-list-open">
                <a href="javascript:void(0);"><i class="icon fa fa-signal"></i>域名交易</a>
                <div class="sidebar-submenu">
                    <div class="sidebar-submenu-item"><a href="#/bcd/onebid/list">一口价域名</a></div>
                </div>
            </div>
            -->
        </div>

        <div class="content-wrap">
            <div class="content-breadcrumb"><span>系统管理</span><span class="divider">/</span><span class="active">单位管理</span></div>
            <div class="content-list">
                <div class="content-heading">单位管理列表</div>
                <div class="list-query">
                    <form class="form-inline" id="queryForm">
                        <div class="form-group">
                            <label>部门名称：</label>
                            <input type="text" class="form-control" name="deptName" data-operator="like">
                        </div>
                        <div class="form-group" style="margin: 0 1em;">
                            <label>部门级别：</label>
                            <input type="email" class="form-control" name="deptLevel">
                        </div>
                        <button type="button" class="btn btn-info" onclick="doQuery()"><i class="fa fa-search"></i> 搜索</button>
                    </form>
                </div>
                <div class="list-function">
                    <button type="button" class="btn btn-success" onclick="addSysDept()"><i class="fa fa-plus"></i> 新增</button>
                </div>
                <table id="datagrid" data-pku-widget="datagrid" class="table table-hover table-bordered"
                       data-url="http://www.20ui.cn/admin/sysDeptListData"
                       data-query-form-id="queryForm">
                       <!--
                        data-url="http://localhost:8080/admin/sysDeptListData"
                        data-url="http://www.20ui.cn/admin/sysDeptListData"
                       -->
                    <thead>
                    <tr>
                        <!--
                            data-column-id：对应bean的属性名
                            data-identifier： Boolean。data-row-id，行ID。（只对一个列使用）
                            data-visible：Boolean。此列是否可见。（可用于标记 行ID 的列）
                            data-sortable：Boolean。此列是否可排序（升序、降序），会拼接 order by 子句，发送请求
                        -->
                        <th data-column-id="deptId" data-identifier="true" data-visible="true" data-sortable="false" >部门标识号</th>
                        <th data-column-id="deptName" data-sortable="false">部门名称</th>
                        <th data-column-id="deptLevel" data-sortable="true">部门级别</th>
                        <th data-column-id="addTime" data-sortable="false" data-formatter="dateFormatter">录入时间</th>

                        <th data-sortable="false" data-column-id="_operation" data-formatter="_operation" data-column-title="操作">
                            <a href="javascript:void(0);" onclick="viewSysDept(this)" data-row="deptId,deptName">详情</a>&nbsp;&nbsp;
                            <a href="javascript:void(0);" onclick="editSysDept(this)" data-row="deptId,deptName">编辑</a>&nbsp;&nbsp;
                            <a href="javascript:void(0);" onclick="deleteSysDept(this)" data-row="deptId">删除</a>
                        </th>
                    </tr>
                    </thead>

                </table>

            </div>
        </div>


    </div>
    <!-- /page-content -->

    <!-- page-footer -->
    <div class="page-footer"></div>
    <!-- /page-footer -->

</div>
<!-- /page -->

<script>
    function doQuery() {
        jQuery( "#datagrid" ).bootgrid( "reload" );
    }
    function dateFormatter( column, row ) {
        var date,
            year,
            month,
            day,
            value
        ;
        value = row[ column.id ];
        if ( ! value ) {
            return "";
        }

        date = new Date( parseInt( value ) );

        year = date.getFullYear();
        month = date.getMonth() + 1;
        day = date.getDate();

        month = ( "0" + month ).slice( -2 );
        day = ( "0" + day ).slice( -2 );

        return year +  "年" + month + "月" + day + "日";
    }

    function deleteSysDept( target ) {
        var $target
        ;
        $target = $( target );
        // 标记
        $target.closest( "tr" ).addClass( "warning" );
        new Dialog( {
            title: "提示",
            content: "确认删除？",
            confirmBtnText: "删除",
            cancelBtnText: "不删除",
            confirmCallback: function () {
                var _this
                ;
                _this = this;
                _this.hide();
                $.post( "http://www.20ui.cn/admin/sysDeptDelete", { deptId: $target.data( "deptId" ) } )
                        .done( function ( response ) {
                            if ( ! response.success ) {
                                new Dialog( { title: "错误", content: "删除失败！" } );
                                return;
                            }
                            new Dialog( { title: "提示", content: "删除成功！" } );
                            // 标记
                            $target.closest( "tr" ).addClass( "danger" ).end().closest( "td" ).html("");
                        } )
                        .fail( function () {
                            ( new Dialog ).show( { title: "错误", content: "网络异常。" } );
                        } );
            },
            cancelCallback: function () {
                this.hide();
            }
        } );

    }

    function viewSysDept ( target ) {
        var $target
                ;
        $target = $( target );
        // 标记
        $target.closest( "tr" ).addClass( "warning" );
        new Dialog( {
            title: "详情 - " + $target.data( "deptName" ),
            content: '<i class="fa fa-spin fa-spinner"></i> 加载...',
            width: 800,
            hasConfirmBtn: false,
            cancelBtnText: "关闭",
            remoteUrl: "http://www.20ui.cn/admin/sysDeptDetail",
            requestData: { deptId: $target.data( "deptId" ) }
        } );
    }

    function editSysDept( target ) {
        var $target
        ;
        $target = $( target );
        // 标记
        $target.closest( "tr" ).addClass( "warning" );
        new Dialog( {
            title: "编辑 - " + $target.data( "deptName" ),
            content: '<i class="fa fa-spin fa-spinner"></i> 加载...',
            confirmBtnText: "保存",
            cancelBtnText: "关闭",
            width: 800,
            remoteUrl: "http://www.20ui.cn/admin/sysDeptEdit",
            requestData: { deptId: $target.data( "deptId" ) },
            requestSuccessCallback: function () {
                var $form
                ;
                $form = this.$container.find( '[data-pku-widget="fv"]' );
                $form.formValidation();
            },
            confirmCallback: function () {
                var $form,
                    $fvInstance,
                    isValid,
                    actionUrl,
                    _this
                ;
                _this = this;
                $form = this.$container.find( '[data-pku-widget="fv"]' );
                $fvInstance = $form.data( 'formValidation' );
                actionUrl = $form.attr( "action" );
                // 校验
                $fvInstance.validate();
                // 判断
                isValid = $fvInstance.isValid();
                // 校验不通过 ， 退出
                if ( !isValid ) {
                    return false;
                }
                _this.$confirmBtn.html( '<i class="fa fa-spin fa-spinner"></i> 保存中' ).attr( "disabled", true );
                // 发送请求保存数据
                $.post( actionUrl, $form.serialize(), null, "json" )
                        .done( function ( data ) {
                            if ( ! ( data && data.success ) ) {
                                new Dialog ( { title: "提示", content: data.message || "保存失败。" } );
                                return;
                            }
                            _this.hide();
                            doQuery();
                        }).fail( function (){
                            new Dialog ( { title: "错误", content: "网络异常。" } );
                            _this.$confirmBtn.html( '<i class="fa fa-spin fa-spinner"></i> 保存中' ).removeAttr( "disabled" );
                        } );
            },
            cancelCallback: function () {
                window.console && console.info( "cancelCallback" );
                this.hide();
            }
        } );
    }

    function addSysDept() {
        new Dialog( {
            title: "新增",
            content: '<i class="fa fa-spin fa-spinner"></i> 加载...',
            confirmBtnText: "保存",
            cancelBtnText: "关闭",
            width: 800,
            remoteUrl: "http://www.20ui.cn/admin/sysDeptEdit",
            requestSuccessCallback: function () {
                var $form
                ;
                $form = this.$container.find( '[data-pku-widget="fv"]' );
                $form.formValidation();
            },
            confirmCallback: function () {
                var $form,
                    $fvInstance,
                    isValid,
                    actionUrl,
                    _this
                ;
                _this = this;
                $form = this.$container.find( '[data-pku-widget="fv"]' );
                $fvInstance = $form.data( 'formValidation' );
                actionUrl = $form.attr( "action" );
                // 校验
                $fvInstance.validate();
                // 判断
                isValid = $fvInstance.isValid();
                // 校验不通过 ， 退出
                if ( !isValid ) {
                    return false;
                }
                _this.$confirmBtn.html( '<i class="fa fa-spin fa-spinner"></i> 保存中' ).attr( "disabled", true );
                // 发送请求保存数据
                $.post( actionUrl, $form.serialize(), null, "json" )
                        .done( function ( data ) {
                            if ( ! ( data && data.success ) ) {
                                new Dialog ( { title: "提示", content: data.message || "保存失败。" } );
                                _this.$confirmBtn.html( '保存' ).removeAttr( "disabled" );
                                return;
                            }
                            _this.hide();
                            doQuery();
                        }).fail( function (){
                            new Dialog ( { title: "错误", content: "网络异常。" } );
                            _this.$confirmBtn.html( '保存' ).removeAttr( "disabled" );
                        } );
            },
            cancelCallback: function () {
                window.console && console.info( "cancelCallback" );
                this.hide();
            }
        } );
    }
</script>
</body>
</html>