<script>
    var BASE_URL = "";
</script>

<script>

    WebUploader.pku = {
        fileUpload: null,// 文件上传
        imageUpload: null,
        template: {}
    };

    WebUploader.pku.template.fileUpload =
            '<ul class="uploader-filelist clearfix"></ul>\
            <div class="uploader-controls">\
                <div class="uploader-picker"><i class="fa fa-file-o"></i> 选择文件</div>\
                <button type="button" class="btn btn-success uploader-startup" ><i class="fa fa-upload"></i>  开始上传</button>\
                <span class="text-warning uploader-info">已上传成功文件数：0。 上传失败文件数：0。</span>\
            </div>';

    WebUploader.pku.fileUpload = function ( containerId, options ) {

        var $,
            defaults,
            $container, // 容器
            $fileList, // 文件列表容器
            $startBtn, // “开始上传”按钮
            $info, // 上传信息
            state, // 上传状态
            uploader // 实例
            ;

        $ = jQuery;
        $container = $( "#" + containerId ).html( WebUploader.pku.template.fileUpload );
        $fileList = $( ".uploader-filelist", $container );
        $startBtn = $( ".uploader-startup", $container );
        $info = $( ".uploader-info", $container );

        defaults = {
            // 不压缩image
            resize: false,
            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: "#" + containerId + " .uploader-picker"
        };

        options = $.extend( defaults, options || {} );

        // 初始化
        uploader = WebUploader.create( options );

        // 上传状态
        uploader.on('all', function(type) {
            if (type === 'startUpload') {
                state = 'uploading';
            } else if (type === 'stopUpload') {
                state = 'paused';
            } else if (type === 'uploadFinished') {
                state = 'done';
            }

            if (state === 'uploading') {
                $startBtn.html('<i class="fa fa-upload"></i> 暂停上传' ).addClass( "btn-warning" );
            } else {
                $startBtn.html('<i class="fa fa-upload"></i> 开始上传').removeClass( "btn-warning" );
            }
        });
        // 点击开始按钮
        $startBtn.on('click', function() {
            if (state === 'uploading') {
                uploader.stop( true ); // 正在上传的文件以及等待上传的文件都暂停
            } else {
                uploader.upload();
            }
        });

        // （当文件被加入队列以后触发。）添加文件条目
        uploader.on( 'fileQueued', function( file ) {
            var fileId,
                    fileName,
                    fileSize
                    ;
            fileId = file.id;
            fileName = file.name;
            fileSize = WebUploader.formatSize( file.size );

            $fileList.append('<li class="uploader-fileitem" id=' + fileId + '>\
                                <button type="button" class="close">&times;</button>\
                                <span class="filename">' + fileName + ' (' + fileSize + ') - </span>\
                                <span class="state">等待上传</span>\
                                <div class="uploader-progress">\
                                   <div class="uploader-progress-bar" style="width: 1%;"></div>\
                                </div>\
                             </li>')

        });

        // 当点击关闭按钮时，标记文件状态为已取消, 同时将中断文件传输。并且删除LI节点
        $fileList.on("click", "button.close", function() {
            var $this,
                    $fileitem,
                    fileId
                    ;
            $this = $(this);
            $fileitem = $this.parent( ".uploader-fileitem" );
            fileId = $fileitem.attr("id");
            uploader.cancelFile(fileId);
            $fileitem.fadeOut();
        }).on("click", ".state > a", function() { // 点击“上传失败”
            var $this,
                    $fileitem,
                    fileId
                    ;
            $this = $(this);
            $fileitem = $this.closest( ".uploader-fileitem" );
            fileId = $fileitem.attr("id");

            uploader.retry( uploader.getFile( fileId ) );
            return false;
        });

        // 文件上传过程中创建进度条实时显示。（上传过程中触发，携带上传进度。）
        uploader.on('uploadProgress', function(file, percentage) {
            var $fileItem,
                    $percent
                    ;
            $fileItem = $('#' + file.id);
            $percent = $fileItem.find( '.uploader-progress-bar');

            $fileItem.addClass("uploading").find('.state').text('上传中');
            $percent.css('width', percentage * 100 + '%');
        });

        // （当文件上传成功时触发。）
        uploader.on('uploadSuccess', function(file) {
            $('#' + file.id).addClass("success").find('.state').text('已上传')
                    .end().find('.close').hide();
        });
        // （当文件上传出错时触发。）
        uploader.on('uploadError', function(file) {
            $('#' + file.id).addClass("error").find('.state').html('上传出错 <a href="#">重新上传</a>');
        });
        // （不管成功或者失败，文件上传完成时触发。）
        uploader.on('uploadComplete', function(file) {
            var stats,
                    successNum,
                    uploadFailNum
                    ;
            stats = uploader.getStats();
            successNum = stats.successNum;
            uploadFailNum = stats.uploadFailNum;
            $info.text("已上传成功文件数：" + successNum + "。 上传失败文件数：" + uploadFailNum + "。");
        });

    };

</script>
<div class="page-upload">

    <div class="callout callout-danger">
        <h4>Web Uploader</h4>
        <p>1. WebUploader是由Baidu WebFE(FEX)团队开发的一个简单的以HTML5为主，FLASH为辅的现代文件上传组件。</p>
        <p>2. 在现代的浏览器里面能充分发挥HTML5的优势，同时又不摒弃主流IE浏览器，沿用原来的FLASH运行时</p>
        <p>3. 兼容IE6+，iOS 6+, android 4+</p>
        <p>4. 参考 <a href="http://fex.baidu.com/webuploader/" target="_blank">Web Uploader</a></p>
    </div>

    <article class="article">
        <header>
            <h3 class="text-muted">1. 示例</h3>
            <hr>
        </header>
        <main>

            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#example" data-toggle="tab">示例</a></li>
                <li role="presentation"><a href="#code" data-toggle="tab">代码</a></li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="example" style="padding: 10px;">
                    <div class="uploader-container uploader-theme-file" id="uploaderContainer">
                    </div>
                    <script>
                        var uploaderContainerId,
                            uploaderOptions
                            ;
                        uploaderContainerId = "uploaderContainer";
                        uploaderOptions = {
                            // swf文件路径
                            swf: BASE_URL + '/Uploader.swf',

                            // 文件接收服务端。
                            server: BASE_URL + '/Upload'
                        };
                        WebUploader.pku.fileUpload( uploaderContainerId, uploaderOptions );
                    </script>
                </div>
                <div role="tabpanel" class="tab-pane" id="code">
<pre class="prettyprint">
&lt;div class="uploader-container uploader-theme-file" id="uploaderContainer">
&lt;/div>
&lt;script>
    jQuery(function(){
        var uploaderContainerId,
            uploaderOptions
            ;
        uploaderContainerId = "uploaderContainer";
        uploaderOptions = {
            // swf文件路径
            swf: BASE_URL + '/Uploader.swf',

            // 文件接收服务端。
            server: BASE_URL + '/Upload'
        };
        WebUploader.pku.fileUpload( uploaderContainerId, uploaderOptions );
    });
&lt;/script>
</pre>
                </div>
            </div>




        </main>
    </article>

</div>


